command:
  - ${env}
  - torchrun
  - --standalone
  - --nproc_per_node=2
  - ${program}
  - ${args}
program: scripts/pretrain_language_model.py
entity: rylan
project: memorization-scoring-vs-sampling-pt-v2
method: grid
parameters:
  data_config:
    parameters:
      corpus:
        values: [ "fineweb-edu-dedup" ]
      benchmark:
        values: [ "EleutherAI/minerva_math" ]
      benchmark_subset_fraction:
        values: [ 1.0 ]
      benchmark_shuffle_seed:
        values: [ 0 ]
      num_benchmark_replicas_per_epoch:
        values: [ 0, 1, 3, 10, 18, 32, 56, 100, 178, 316, 562, 1000, 1778, 3162 ]
      shuffle_seed:
        values: [ 0 ]
      train_test_split_seed:
        values: [ 0 ]
  model_config:
    parameters:
      attn_implementation:
        values: [ "flash_attention_2" ]
      model_name:
        values: [ "Qwen3/Qwen3-344M" ]
      torch_dtype:
        values: [ "bfloat16" ]
  trainer_config:
    parameters:
      adam_beta1:
        values: [ 0.9 ]
      adam_beta2:
        values: [ 0.95 ]
      data_seed:
        values: [ 0 ]
      dataloader_drop_last:
        values: [ True ]
      dataloader_num_workers:
        values: [ 16 ]
      dataloader_prefetch_factor:
        values: [ 8 ]
      eval_on_start:
        values: [ True ]
      eval_strategy:
        values: [ steps ]
      eval_steps:
        values: [ 4000 ]
      full_determinism:
        values: [ True ]
      gradient_checkpointing:
        values: [ False ]
      hub_strategy:
        values: [ "end" ]
      base_learning_rate:
        values: [ 0.000001 ]
      logging_steps:
        values: [ 50 ]
      lr_scheduler_type:
        values: [ "cosine" ]
      max_grad_norm:
        values: [ 1.0 ]
      max_length:
        values: [ 2048 ]
      max_steps:
        values: [ -1 ]
      num_train_epochs:
        values: [ 1 ]
      optim:
        values: [ "adamw_torch_fused" ]
      overtrain_multiplier:
        values: [ 1.0 ]
      per_device_eval_batch_size:
        values: [ 48 ]
      per_device_train_batch_size:
        values: [ 46 ]
      remove_unused_columns:
        values: [ True ]
      report_to:
        values: [ "wandb" ]
      save_strategy:
        values: [ "no" ]
      save_total_limit:
        values: [ 1 ]
      torch_compile:
        values: [ True ]
      warmup_ratio:
        values: [ 0.2 ]
      weight_decay:
        values: [ 0.01 ]
  seed:
    values: [ 0 ]
