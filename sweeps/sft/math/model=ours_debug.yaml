program: scripts/sft_language_model.py
entity: rylan
project: memorization-scoring-vs-sampling-sft
method: grid
parameters:
  data_config:
    parameters:
      dataset:
        values: [ "EleutherAI/minerva_math" ]
      shuffle_seed:
        values: [0]
      split_to_train_on:
        values: ["train"]
  model_config:
    parameters:
      attn_implementation:
        values: [ "eager" ]
      device_map:
        values: [ "auto" ]
      initial_model_name_or_path:
        values: 
          # 62M models
          - "RylanSchaeffer/mem_Qwen3-62M_minerva_math_rep_0_sbst_1.0000_epch_1_ot_1"
          - "RylanSchaeffer/mem_Qwen3-62M_minerva_math_rep_316_sbst_1.0000_epch_1_ot_1"
          # 34M models
          - "RylanSchaeffer/mem_Qwen3-34M_minerva_math_rep_0_sbst_1.0000_epch_1_ot_1"
          - "RylanSchaeffer/mem_Qwen3-34M_minerva_math_rep_316_sbst_1.0000_epch_1_ot_1"
      torch_dtype:
        values: [ "bfloat16" ]
  sft_trainer_config:
    parameters:
      data_seed:
        values: [ 0 ]
      dataloader_drop_last:
        values: [ True ]
      dataloader_num_workers:
        values: [ 4 ]
      dataloader_prefetch_factor:
        values: [ 4 ]
      eval_on_start:
        values: [ True ]
      eval_strategy:
        values: [ steps ]
      eval_steps:
        values: [ 100 ]
      gradient_accumulation_steps:
        values: [ 4, 8, 16, 32 ]
      gradient_checkpointing:
        values: [ True ]
      hub_strategy:
        values: ["end"]
      learning_rate:
        values: [ 0.00001, 0.0001, 0.001 ]
      logging_steps:
        values: [ 1 ]
      lr_scheduler_type:
        values: [ "linear" ]
      max_grad_norm:
        values: [ 1.0 ]
      max_length:
        values: [ 2048 ]
      max_steps:
        values: [ -1 ]
      num_train_epochs:
        values: [ 1, 3, 5 ]
      optim:
        values: [ "adamw_torch" ]
      per_device_eval_batch_size:
        values: [ 10 ]
      per_device_train_batch_size:
        values: [ 4 ]
      remove_unused_columns:
        values: [ True ]
      report_to:
        values: ["wandb"]
      save_strategy:
        values: [ "best" ]
      save_total_limit:
        values: [ 1 ]
      torch_compile:
        values: [ False ]
      warmup_ratio:
        values: [ 0.1 ]
      weight_decay:
        values: [ 0.0 ]
  seed:
    values: [0]
